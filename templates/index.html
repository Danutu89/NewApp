<!DOCTYPE html>
<html {% if location %}lang="{{location.lang}}-{{location.lang|upper}}" {% endif %} {% if current_user.is_authenticated %}id={{current_user.id}}{% endif %}>
<head>
  {% if error_check != True %}
  {% if request.url_rule.endpoint == 'home.home' %}<title>New App - Where Developers Learn, Share, & Code</title>{% endif %}
  {% if request.url_rule.endpoint == 'users.user' %}<title>{{user.name[0]|upper}}{{user.name[1:]}} - NewApp</title>{% endif %}
  {% if request.url_rule.endpoint == 'home.post' %}<title>{{posts.title}} - NewApp</title>{% endif %}
  <meta charset="utf-8">
  <meta name="msvalidate.01" content="FA1B41824E0AF3D2CC7B0F86730E5C45" />
  <meta name="yandex-verification" content="c303cb257b715901" />
  <link rel='icon' href="https://newapp.nl/static/favicon_web.png" type='image/x-icon' />
  <link rel="preconnect" href="https://newappcdn.b-cdn.net/" crossorigin>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  {% if request.url_rule.endpoint == 'home.home' %}
  <script type="application/ld+json">    
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "url": "https://newapp.nl/",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://newapp.nl/search={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
  </script>
  <meta name="keywords" content="newapp,forum,developers,web">
  {% endif %}
  {% if request.url_rule.endpoint == 'home.post' %}
  <meta name="keywords" content="{% for key in keywords %}{{key}},{% endfor %}newapp">
  {% endif %}
  {% if request.url_rule.endpoint == 'users.user' %}
  <meta name="keywords" content="newapp,{{user.name}}">
  {% endif %}
  <meta name="theme-color" content="rgb(34, 34, 34)" />
  <meta name="application-name" content="NewApp">
  <meta name="apple-mobile-web-app-title" content="NewApp">
  {% if request.url_rule.endpoint == 'home.home' %}
  <meta name="description" content="NewApp the newest community for developers to learn, share​ ​their programming ​knowledge, and build their careers.">
  {% endif %}
  {% if request.url_rule.endpoint == 'users.user' %}
  <meta name="description" content="{{user.name}} - {{user.bio}}">
  {% endif %}
  {% if request.url_rule.endpoint == 'home.post' %}
  <meta name="description" content="{{posts.text[35:100]}}">
  {% endif %}
  <link rel="canonical" href="https://newapp.nl{{ request.path }}">
  <link rel="manifest" href="https://newapp.nl/static/manifest.json">
  <link rel="alternate" type="application/rss+xml" title="NewApp RSS Feed" href="https://newapp.nl/feed">
  {% if location %}
  <meta http-equiv="content-language" content="{{location.lang}}">{% endif %}
  <link rel="search" type="application/opensearchdescription+xml" title="NewApp" href="https://newapp.nl/opensearch">
  {% if request.url_rule.endpoint == 'home.home' %}
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://newapp.nl/">
  <meta property="og:site_name" content="New App">
  <meta property="og:description"
    content="The newest community for developers to learn, share​ ​their programming ​knowledge, and build their careers.">
  {% elif request.url_rule.endpoint == 'users.user' %}
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{request.path}}">
  <meta property="og:site_name" content="{{user.name}}">
  <meta property="og:image" itemprop="image primaryImageOfPage" content="https://newapp.nl{{user.avatar}}">
  <meta property="og:description" content="{{user.bio}}">
  {% elif request.url_rule.endpoint == 'home.post' %}
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{request.path}}">
  <meta property="og:site_name" content="{{posts.title}}">
  {% if posts.thumbnail %}
  <meta property="og:image" itemprop="image primaryImageOfPage" content="https://newapp.nl/static/thumbnail_post/post_{{posts.id}}.jpeg">
  {% else %}
  <meta property="og:image" itemprop="image primaryImageOfPage" content="https://newapp.nl/static/favicon.png">
  {% endif %}
  <meta property="og:description" content="{{posts.text[3:100]}}">
  {% endif %}
  {% endif %}
  <meta name="environment" content="production">
  <script async src="https://newappcdn.b-cdn.net/newapp.js"></script>
  <script async src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
  {% include 'style.html' %}
</head>
<header>
  <nav class="newapp-navbar">
    <div class="navbar-items">
      <div class="navbar-item">
        <a href="/" class="navbar-logo"><img style="vertical-align: middle;margin-left: -1px;" src="https://newapp.nl/static/logo.svg"
            width="30" height="30" alt=""><span style="margin-left: 0.2rem;" class="newapp-title"><span style="color:#18BC9C;">New</span><span
              style="color:white;">App</span><span style="color:#18BC9C;font-size: 55%;font-weight: 600;">
              Beta</span></span></a>
      </div>
      <div class="navbar-item navbar-center navbar-search">
        <form action="/" method="GET">
          <input type="text" name="search" placeholder="Search">
        </form>
      </div>

      {% if current_user.is_authenticated == false %}
      <div class="navbar-item" style="margin-inline-start: auto;display:flex;">
        <a href="#login-modal" style="color: white;margin-block-start:auto;margin-block-end: auto;cursor: pointer;"><span
            style="vertical-align: inherit;"><span class="fas fa-sign-in-alt"></span> Login</span></a>
      </div>
      {% else %}
      <div style="margin-inline-start: auto;display:flex;">
          <div class="navbar-item">
              <div class="newapp-dropdown">
                  <i class="far fa-bell fa-lg" style="    margin-top: 0.55rem;
                  margin-right: 0.4rem;{% if request.MOBILE %}margin-right:0.9rem;{% endif %}"></i>
                  <div class="newapp-dropdown-content" style="min-width: 13rem;margin-inline-start:-12.4rem;">
                      Notifications
                      <hr>
                    {% for notification in current_user.n_receiver %}
                    {% if notification.checked == False %}
                      <div class="dropdown-item" style="display:flex;">
                          <img src="{{notification.author.avatar}}" height="30px" width="30px" style="border-radius: 30px;" alt="">
                          <a  href="{{notification.link}}?notification={{notification.id}}" style="color: white;margin-left: 0.4rem;">{{notification.body}}</a>
                        </div>
                      {% endif %}
                      {% endfor %}
                  </div>
              </div>
            </div>
          {% if request.url_rule.endpoint != 'home.newpost' %}
          {% if request.MOBILE == False %}
          <div class="navbar-item">
              <a href="/newpost"><button class="navbar-button" style="margin-right:0.7rem">New Post</button></a>
          </div>
          {% else %}
          <div class="navbar-item">
              <a href="/newpost"><i class="fas fa-plus-circle fa-lg" style="color:white;margin-top: 0.55rem;
                margin-right: 0.9rem;"></i></a>
          </div>
          {% endif %}
          {% endif %}
          <div class="navbar-item">
            <div class="newapp-dropdown">
                <img src="{{current_user.avatar}}" height="30px" width="30px" style="border-radius: 30px;" alt="">
              <div class="newapp-dropdown-content">
                @{{current_user.name}}
                <hr>
                <div class="dropdown-item">
                  <a href="{{url_for('users.user', id=current_user.id, name=current_user.name)}}" style="color: white;"><i class="fas fa-user"></i> Profile</a>
                </div>
                {% if current_user.roleinfo.admin_panel_permission %}
                <div class="dropdown-item">
                  <a href="{{url_for('admin.main')}}" style="color: white;"><i class="fas fa-user-shield"></i>
                    Admin</a>
                </div>
                {% endif %}
                <div class="dropdown-item">
                  <a href="{{url_for('users.settings', name=current_user.name)}}" style="color: white;"><i class="fas fa-user-cog"></i></i> Settings</a>
                </div>
                <div class="dropdown-item">
                  <a href="{{url_for('users.logout')}}" style="color: white;"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
              </div>
            </div>
          </div>
      </div>
      {% endif %}
    </div>
  </nav>
</header>
<content>
  {% if error_check != True %}
  {% if request.MOBILE %}
  {% if request.url_rule.endpoint == 'home.home' %}
  <!-- <div class="open-wrapper">
      <i class="fas fa-coins fa-lg" id="open-wrapper" onclick="openNav()"></i>
  </div> -->
  {% include 'wrapper_left.html' %}
  {% endif %}
  {% else %}
  {% include 'sidebar_left.html' %}
  {% endif %}
  {% endif %}
  {% block content %}
  {% endblock %}
  {% if error_check != True %}
  {% include 'sidebar_right.html' %}
  {% endif %}
</content>
{% if error_check != True %}
{% if request.MOBILE %}
<!-- <navigation>
  <div class="navigation-item">
      <i class="fas fa-chevron-left" onclick="window.history.back();"></i>
  </div>
  <div class="navigation-item">
      <i class="fas fa-home" onclick="goHome()"></i>
  </div>
  <div class="navigation-item">
      <i class="fas fa-chevron-right" onclick="window.history.forward();"></i>
  </div>
</navigation>
<script>
  function goHome(){
    window.location.pathname = "/";
  }
</script> -->
{% endif %}
{% endif %}
{% include 'modals.html' %}

<script>
  var loadCss = function(cssPath){
    var cssLink = document.createElement('link');
    cssLink.rel = 'stylesheet';
    cssLink.href = cssPath;
    var head = document.getElementsByTagName('head')[0];
    head.appendChild(cssLink);
  };
  var loadJs = function(cssPath){
    var cssLink = document.createElement('script');
    cssLink.src = cssPath;
    var head = document.getElementsByTagName('head')[0];
    head.appendChild(cssLink);
  };
  document.onreadystatechange = function () {
    if (document.readyState === "complete") {
      loadCss("https://newappcdn.b-cdn.net/all.css");
      loadCss("https://newappcdn.b-cdn.net/styles.css");
      loadJs("https://www.googletagmanager.com/gtag/js?id=UA-145440871-1");
      setTimeout(init_NewApp,1000);
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'UA-145440871-1', {
        'optimize_id': 'GTM-KKCQ2T7'
      });
      {% if current_user.is_authenticated %}
      gtag('set', {'user_id': '{{current_user.id}}'});
      {% endif %}

      {%  if request.endpoint == 'home.home' %}
      LoadTrending();
      {% elif request.endpoint == 'home.post' %}
      LoadTrending();
      {% endif %}
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register("https://" + window.location.hostname + "/sw.js").then(function(registration) {
            // Registration was successful
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          }, function(err) {
            // registration failed :(
            console.log('ServiceWorker registration failed: ', err);
          });
        });
      }
      };
  }
</script>
{% if request.url_rule.endpoint == 'home.home' %}
{% if request.MOBILE %}
<script>
  function openNav() {
    document.getElementById("wrapper-left").style.width = "250px";
    document.getElementById("wrapper-left").style.margin = "0";
    wrapper_opened = true;
  }
  
  function closeNav() {
    document.getElementById("wrapper-left").style.width = "0";
    document.getElementById("wrapper-left").style.margin = "-20px";
    wrapper_opened = false;
  }
  </script>
<script>
  document.addEventListener('touchstart', handleTouchStart, false);        
document.addEventListener('touchmove', handleTouchMove, false);

var xDown = null;                                                        
var yDown = null;

function getTouches(evt) {
  return evt.touches ||             // browser API
         evt.originalEvent.touches; // jQuery
}                                                     

function handleTouchStart(evt) {
    const firstTouch = getTouches(evt)[0];                                      
    xDown = firstTouch.clientX;                                      
    yDown = firstTouch.clientY;                                      
};                                                

function handleTouchMove(evt) {
    if ( ! xDown || ! yDown ) {
        return;
    }

    var xUp = evt.touches[0].clientX;                                    
    var yUp = evt.touches[0].clientY;

    var xDiff = xDown - xUp;
    var yDiff = yDown - yUp;

    if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {/*most significant*/
        if ( xDiff > 0 ) {
          closeNav();
        } else {
          openNav();
        }                       
    } else {
        if ( yDiff > 0 ) {
            /* up swipe */ 
        } else { 
            /* down swipe */
        }                                                                 
    }
    /* reset values */
    xDown = null;
    yDown = null;                                             
};
</script>
{% endif %}
{% endif %}
</body>

</html>
