<!DOCTYPE html>
<html>
<script type="text/javascript">
  function script(url) {
    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = url;
    var x = document.getElementsByTagName('head')[0];
    x.appendChild(s);
  }
</script>
<script>
  var cScriptLoader = (function () {
    function cScriptLoader(files) {
      var _this = this;
      this.log = function (t) {
        console.log("NewApp: " + t);
      };
      this.withNoCache = function (filename) {
        if (filename.indexOf("?") === -1)
          filename += "?no_cache=" + new Date().getTime();
        else
          filename += "&no_cache=" + new Date().getTime();
        return filename;
      };
      this.loadStyle = function (filename) {
        // HTMLLinkElement
        var link = document.createElement("link");
        link.rel = "stylesheet";
        link.type = "text/css";
        link.href = filename;
        _this.log('Loading style ' + filename);
        link.onload = function () {
          _this.log('Loaded style "' + filename + '".');
        };
        link.onerror = function () {
          _this.log('Error loading style "' + filename + '".');
        };
        _this.m_head.appendChild(link);
      };
      this.loadScript = function (i) {
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = (_this.m_js_files[i]);
        var loadNextScript = function () {
          if (i + 1 < _this.m_js_files.length) {
            _this.loadScript(i + 1);
          }
        };
        script.onload = function () {
          _this.log('Loaded script "' + _this.m_js_files[i] + '".');
          loadNextScript();
        };
        script.onerror = function () {
          _this.log('Error loading script "' + _this.m_js_files[i] + '".');
          loadNextScript();
        };
        _this.log('Loading script "' + _this.m_js_files[i] + '".');
        _this.m_head.appendChild(script);
      };
      this.loadFiles = function () {
        // this.log(this.m_css_files);
        // this.log(this.m_js_files);
        for (var i = 0; i < _this.m_css_files.length; ++i)
          _this.loadStyle(_this.m_css_files[i]);
        _this.loadScript(0);
      };
      this.m_js_files = [];
      this.m_css_files = [];
      this.m_head = document.getElementsByTagName("head")[0];
      // this.m_head = document.head; // IE9+ only
      function endsWith(str, suffix) {
        if (str === null || suffix === null)
          return false;
        return str.indexOf(suffix, str.length - suffix.length) !== -1;
      }
      for (var i = 0; i < files.length; ++i) {
        if (endsWith(files[i], ".css")) {
          this.m_css_files.push(files[i]);
        } else if (endsWith(files[i], ".js")) {
          this.m_js_files.push(files[i]);
        } else
          this.log('Error unknown filetype "' + files[i] + '".');
      }
    }
    return cScriptLoader;
  })();
</script>

<head>
  <title>New App</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <script>
    var ScriptLoader = new cScriptLoader([
      "https://cdn.quilljs.com/1.3.6/quill.snow.css",
      "https://use.fontawesome.com/releases/v5.8.2/css/all.css",
      "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css",
      "https://bootswatch.com/4/flatly/bootstrap.css",
      "https://code.jquery.com/jquery-3.3.1.slim.min.js",
      "https://cdn.quilljs.com/1.3.6/quill.min.js",
      "https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js",
      "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    ]);
    var loaded = ScriptLoader.loadFiles();
  </script>

  <style>
    .popover-body {
      padding-left: 0;
      padding-right: 0;
    }

    .post_reply {
      height: 20%;
    }

    .form-reply {
      height: 100%;
    }
  </style>
</head>
<header>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary" style="padding: .3rem 1rem !important;">
    <a class="navbar-brand" href="{{url_for('home.home')}}">New App</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
      </ul>
      <ul class="navbar-nav mr-auto col-md-5 nav-fill" style="padding-right: 0">
        <li class="nav-item">
          <form action="{{url_for('home.home')}}" method="GET" hidden>
            <div class="input-group mb-0">
              {{search.search}}
              <div class="input-group-append">
                {{search.submit}}
              </div>
            </div>
          </form>
        </li>
      </ul>
      <ul class="navbar-nav">
        {% if current_user.is_authenticated == false %}
        <li class="nav-item">
          <a class="nav-link" style="cursor:pointer" data-toggle="modal" data-target="#login"><span
              class="fas fa-sign-in-alt"></span>
            Login</a>
        </li>
        {% else %}
        <li class="nav-item">
          <a id="nav_img_{{current_user.id}}" class="nav-link" data-toggle="popover" data-dismiss="popover"
            data-placement="bottom" style="margin-bottom: 0" href="#">
            <h8 id="nav_name_{{current_user.id}}">{{current_user.name}}</h8>
          </a>
          </a>
        </li>
      </ul>
      {% endif %}
    </div>
  </nav>

</header>

<body>
  <div class="container" id="cont" style="margin-top: 10px;">
    {% if current_user.is_authenticated %}
    <script>
      function isScriptLoaded(src) {
        return document.querySelector('script[src="' + src + '"]') ? true : false;
      }

      function LoadPopUp() {


        jQuery(document).ready(function ($) {

          jQuery("[data-toggle=popover]").popover({
            html: true,
            content: `
                <div id="popover-content">
                            <a class="nav-link" href="{{url_for('users.user',name=current_user.name,id=current_user.id)}}"> <span class="fas fa-user"></span> Profile</a>
                            <a class="nav-link" href="/logout"> <span class="fas fa-sign-out-alt"></span> Logout</a>   
                            {% if current_user.role == 10 %}
                              <a class="nav-link" href="/admin"> <span class="fas fa-user-shield"></span> Admin</a>
                            {% endif %} 
                        </div>
                  `
          });
        });


      }
      window.addEventListener("load", LoadPopUp, false);
    </script>

    {% endif %}
    <script>
      function LoadAlerts() {
        jQuery.noConflict();
        jQuery(document).ready(function ($) {
          // show the alert
          setTimeout(function () {
            jQuery(".alert").alert('close');
          }, 2000);
        });

      }
      window.addEventListener("load", LoadAlerts, false);
    </script>
    <script>
      function Create_Question() {
        var x = document.getElementById("create_question");
        if (x.style.display === "block") {
          x.style.display = "none";
        } else {
          x.style.display = "block";
        }
      }
    </script>
    <script>
      window.addEventListener("load", function () {
        var x = document.createElement("IMG");
        x.setAttribute("class", "rounded-circle img-responsive");
        x.setAttribute("src", "{{current_user.avatar}}");
        x.setAttribute("style", "margin-top: -5px;margin-right: 5px;");
        x.setAttribute("height", "30px");
        x.setAttribute("title", "profile image");
        var child = document.getElementById("nav_name_{{current_user.id}}");
        document.getElementById("nav_img_{{current_user.id}}").insertBefore(x, child);
      });
    </script>
    <script>
      function LoadImages(id, photo) {
        window.addEventListener("load", function () {
          var x = document.createElement("IMG");
          x.setAttribute("class", "rounded-circle img-responsive");
          x.setAttribute("style","margin-right: 5px;");
          x.setAttribute("src", photo);
          x.setAttribute("height", "30px");
          x.setAttribute("title", "profile image");
          var child = document.getElementById("name_" + id);
          document.getElementById("img_" + id).insertBefore(x, child);
        });
      }
      function LoadReplyImages(id, photo) {
        window.addEventListener("load", function () {
          var x = document.createElement("IMG");
          x.setAttribute("class", "rounded-circle img-responsive");
          x.setAttribute("style","margin-right: 5px;");
          x.setAttribute("src", photo);
          x.setAttribute("height", "30px");
          x.setAttribute("title", "profile image");
          var child = document.getElementById("reply_name_" + id);
          document.getElementById("reply_img_" + id).insertBefore(x, child);
        });
      }
    </script>
    {% for success in get_flashed_messages(category_filter=["success"]) %}
    <div class="alert alert-success alert-dismissible fade show" id="success-alert" role="alert">
      <i class="far fa-check-circle"></i>
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Success!</strong> {{success}}
    </div>
    {% endfor %}
    {% for error in get_flashed_messages(category_filter=["error"]) %}
    <div class="alert alert-danger alert-dismissible fade show" id="success-alert" role="alert">
      <i class="far fa-check-circle"></i>
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Error!</strong> {{error}}
    </div>
    {% endfor %}

    {% block content %}
    {% endblock %}

    {% if current_user.is_authenticated == false %}
    <div class="modal" id="register" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Register</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form class="form-signin" action="/register" role="form" method="POST">
              {{register.csrf_token}}
              {{register.username}}
              <br>
              {{register.realname}}
              <br>
              {{register.github}}
              <br>
              {{register.email}}
              <br>
              {{register.password}}
              <br>
              {{register.confirm_password}}
              <br>
              {{register.submit}}
            </form>
          </div>
          <div class="modal-footer">
            Already have an account? <a style="color:#18BC9C;cursor: pointer;margin-left: 5px;" data-toggle="modal"
              data-dismiss="modal" data-target="#login"> Login here</a>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="login" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Login</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form class="form-signin" action="/login" role="form" method="POST">
              {{register.csrf_token}}
              {{login.username}}
              <br>
              {{login.password}}
              <h8 style="font-size: 9px">Forgot Password?<a style="color:#18BC9C;cursor: pointer;margin-left: 2px;"
                  data-toggle="modal" data-dismiss="modal" data-target="#reset_password">Click here</a></h8>
              <br>
              {{login.submit}}
            </form>
          </div>
          <div class="modal-footer">
            You don`t have an account? <a style="color:#18BC9C;cursor: pointer;margin-left: 5px;" data-toggle="modal"
              data-dismiss="modal" data-target="#register"> Register here</a>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="reset_password" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Reset Password</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form class="form-signin" action="{{url_for('users.reset_password')}}" role="form" method="POST">
              {{reset.csrf_token}}
              {{reset.email}}
              <br>
              {{reset.password}}
              <br>
              {{reset.submit}}
            </form>
          </div>
          <div class="modal-footer">
            Already have an account? <a style="color:#18BC9C;cursor: pointer;margin-left: 5px;" data-toggle="modal"
              data-dismiss="modal" data-target="#login"> Login here</a>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</body>

</html>