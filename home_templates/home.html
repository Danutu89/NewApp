{% extends "index.html" %}
{% block content %}

<div class="row">
    <div class="col" style="min-width:310px;">
        {% if current_user.is_authenticated %}
        <div class="card" style="margin-bottom:10px;">
            <button onclick="Create_Question()" class="btn btn-light btn-sm" style="float:right;">New Question</button>
        </div>
        <form class="form-thread" id="create_question" role="form" method="post" action="/" style="display:none;">
            <div class="card" style="margin-bottom:10px;">
                <div class="card-body">
                    {{new_question.csrf_token}}
                    {{new_question.title}}
                    {{new_question.text}}
                    <div class="editor" id="editor"></div>
                    {{new_question.tag}}
                    <small class="form-text text-muted">
                        Separate tags with commas.
                    </small>
                    {{new_question.submit}}
                </div>
            </div>
        </form>
        {% endif %}
        {% for post in posts.items %}
        {% if post.approved %}
        <div class="card" style="margin-bottom:10px;">
            <div class="card-body">
                <div class="row">
                    <div class="col-2" style="min-width:110px;">
                        <button type="button" class="btn btn-outline-primary btn-sm"
                            style="width: 100%;margin-bottom:2px;" disabled>{{post.replies()}} Answers</button>

                        <button type="button" class="btn btn-outline-primary btn-sm" style="width: 100%;"
                            disabled>{{post.views}} Views</button>
                    </div>
                    <div class="col">
                        <h5 class="card-title"><a href="{{url_for('home.post', id=post.id, title=post.title)}}"
                                style="color: #212529;">{{post.title}}</a></h5>

                        {% for tag in tags %}
                        {% if tag.post_id == post.id %}
                        <a href="{{url_for('home.home',tag_finder=tag.tag)}}" class="badge badge-success"
                            style="font-size:10px;">{{tag.tag}}</a>
                        {% endif %}
                        {% endfor %}
                        <div id="img_{{post.id}}" class="author" style="float:right;">
                            <a id="name_{{post.id}}" style="color: #333"
                                href="{{url_for('users.user', name=post.user_in.name, id=post.user_in.id )}}">{{post.user_in.name}}</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
        {% if posts.pages > 1 %}
        <nav aria-label="Pagination">

            <ul class="pagination">
                {% if posts.has_prev %}
                <li class="page-item">
                    {% if request.args.get('search') %}
                    <a class="page-link" href="{{url_for('home.home',page=posts.page-1, search=request.args.get('search'))}}"
                        aria-disabled="true">Previous</a>
                    {% elif request.args.get('tag_finder') %}
                    <a class="page-link" href="{{url_for('home.home',page=posts.page-1, search=request.args.get('tag_finder'))}}"
                        aria-disabled="true">Previous</a>
                    {% else %}
                    <a class="page-link" href="{{url_for('home.home',page=posts.page-1)}}"
                        aria-disabled="true">Previous</a>
                    {% endif %}
                </li>
                {% endif %}
                {% for pages in posts.iter_pages(left_edge=1, right_edge=1, left_current=3, right_current=3) %}
                {% if pages %}
                {% if pages == posts.page %}
                <li class="page-item disabled"><a class="page-link">{{pages}} <span class="sr-only">(current)</span></a>
                </li>
                {% else %}
                {% if request.args.get('search') %}
                <li class="page-item"><a class="page-link" href="{{url_for('home.home', page=pages, search=request.args.get('search'))}}">{{pages}}</a>
                {% elif request.args.get('tag_finder') %}
                <li class="page-item"><a class="page-link" href="{{url_for('home.home', page=pages, search=request.args.get('tag_finder'))}}">{{pages}}</a>
                {% else %}
                <li class="page-item"><a class="page-link" href="{{url_for('home.home', page=pages)}}">{{pages}}</a>
                {% endif %}
                </li>
                {% endif %}
                {% else %}
                {% endif %}
                {% endfor %}
                {% if posts.has_next %}
                <li class="page-item">
                    {% if request.args.get('search') %}
                    <a class="page-link" href="{{url_for('home.home',page=posts.page+1, search=request.args.get('search'))}}" aria-disabled="true">Next</a>
                    {% elif request.args.get('tag_finder') %}
                    <a class="page-link" href="{{url_for('home.home',page=posts.page+1, search=request.args.get('tag_finder'))}}" aria-disabled="true">Next</a>
                    {% else %}
                    <a class="page-link" href="{{url_for('home.home',page=posts.page+1)}}" aria-disabled="true">Next</a>
                    {% endif %}
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </div>
    <div class="col-md-3" style="min-width:310px;width:100%;">
        <div class="pop_post" style="line-height: 1.9;">
            <h4>Popular Posts</h4>

            {% for post in popular_posts %}
            <a style="color:#07C" href="{{url_for('home.post',id=post.id, title=post.title)}}">{{post.title}}</a><span
                class="badge badge-light"
                style="padding-left:3%;padding-right:3%;float:right;font-size: 13px;font-weight: 500;">{{post.views}}</span>
            <br>
            {% endfor %}

        </div>
        <hr>
        <div class="pop_tags" style="line-height: 1.9;">
            <h4>Popular Tags</h4>
            {% for tag in most_tags %}
            {% if tag.tag is not none %}
            <a style="text-decoration: none;" href="{{url_for('home.home',tag_finder=tag.tag)}}"><i class="fab fa-{{tag.tag}}"></i> <span
                    class="badge badge-light" style="font-size: 12px;"> {{tag.tag}}</span></a>
            <br>
            {% endif %}
            {% endfor %}

        </div>
    </div>
</div>
<script>
    var toolbarOptions = [
        ['bold', 'italic', 'underline'],
        ['blockquote', 'code-block'],
        [{
            'header': [1, 2, 3, 4, 5, 6, false]
        }],
        [{
            'color': []
        }, {
            'background': []
        }],
        [{
            'font': []
        }],
        [{
            'align': []
        }],
    ];

    function LoadQuill() {
        var quill = new Quill('#editor', {
            modules: {
                toolbar: toolbarOptions
            },
            theme: 'snow'
        });
    }
    window.addEventListener("load", LoadQuill, false);
    var submit_entry = function () {
        var hidden_text_field = document.getElementById('text');
        hidden_text_field.value = document.querySelector(".ql-editor").innerHTML
    }
    var new_post_form = document.getElementsByClassName('form-thread')[0];
    new_post_form.onsubmit = submit_entry;
</script>
<script>
    var posts = [{% for post in posts.items %}{{post.id}},{% endfor %}]
    var posts_img = [{% for post in posts.items %}"{{post.user_in.avatar}}",{% endfor %}]
    var i;
    for (i = 0; i < posts.length; i++) { 
        LoadImages(posts[i], posts_img[i]); 
    }
   
</script>
{% endblock %}